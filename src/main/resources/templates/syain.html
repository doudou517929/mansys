<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
            integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
            crossorigin="anonymous"
    />


    <title>社内統合管理システム</title>
    <script th:src="@{/js/head.js}" type="text/javascript"></script>
    <script th:src="@{/js/headandtags.js}" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script>
        $(document).ready(function() {
            var searchButton = $('#search');
            searchButton.click(function() {
                var zaisyaCheckbox = $('#zaisya');
                var taisyaCheckbox = $('#taisya');
                if (!zaisyaCheckbox.prop('checked') && !taisyaCheckbox.prop('checked')) {
                    alert('在籍と非在籍がいずれにしても、１つのチェックが必須です。');
                }
            });
            
            $("#search").submit(function() {
                var formData = $("#syainsearch").serialize();
                $.ajax({
                    url: "/syain/search",
                    method: "POST",
                    data: formData,
                    dataType: "json",
                    success: function(response) {
                        var tableBody = $("#syainTable tbody");
                        tableBody.empty();
                        var cnt = response.length;
                        $('#cnt').text(cnt+"    ");
                        $.each(response, function(index, item) {
                            var cnt = data[key].length;
                            $('#cnt').text(cnt);
                            $.each(data[key], function(i, item) {
                                var values = Object.values(item);
                                var row = '<tr>' +
                                    '<td>' + values[1] + '</td>' +
                                    '<td>' + values[2] + '</td>' +
                                    '<td>' + values[3] + '</td>' +
                                    '<td>' + values[4] + '</td>' +
                                    '<td>' + values[5] + '</td>' +
                                    '<td>' + values[6] + '</td>' +
                                    '<td><a href="/syain/upload/rirekisyo?id=' + values[0] + '">登録</a></td>' +
                                    '<td>' +
                                    '<a href="/syain/update?id=' + values[0] + '">更新</a>' +
                                    '<br>' +
                                    '<a href="/syain/delete?id=' + values[0] + '">削除</a>' +
                                    '</td>' +
                                    '</tr>';
                                tableBody.append(row);
                            });
                        });
                    },
                    error: function(xhr, status, error) {
                        console.log('Error: ' + Status + ' ' + error);
                    }
                });
            });
            
            $.ajax({
                url: '/syain/show',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
					var link = $('a[href="/add_employee"]');
                    link.attr('href', '/syain/upload/Syain');
                    for (var key in data) {
                        if (key == 'kaisya') {
                            var kaisya = data[key];
                            var kaisyaSelect = $('#kaisya');
                            $.each(kaisya, function(index, item) {
                                kaisyaSelect.append($('<option></option>').attr('value', item.category2).text(item.value1));
                            });
                            kaisyaSelect.append($('<option></option>').attr('value', 0).text("全て").attr('selected', true));
                        }
                        if (key == 'syokugyo') {
                            var syokugyo = data[key];
                            var syokugyoSelect = $('#syokugyo');
                            $.each(syokugyo, function (index, item) {
                                var option = $('<option></option>').attr('value', item.category3).text(item.value1);
                                if (item.category3 == '4') {
                                    option.attr('selected', true);
                                }
                                syokugyoSelect.append(option);
                            });
                        }
                        if (key == 'syainTables') {
                            var cnt = data[key].length;
                            $('#cnt').text(cnt);
                            $.each(data[key], function(i, item) {
                                var values = Object.values(item);
                                var row = '<tr>' +
                                    '<td>' + values[1] + '</td>' +
                                    '<td>' + values[2] + '</td>' +
                                    '<td>' + values[3] + '</td>' +
                                    '<td>' + values[4] + '</td>' +
                                    '<td>' + values[5] + '</td>' +
                                    '<td>' + values[6] + '</td>' +
                                    '<td><a href="/syain/upload/rirekisyo?id=' + values[0] + '">登録</a></td>' +
                                    '<td>' +
                                    '<a href="/syain/update?id=' + values[0] + '">更新</a>' +
                                    '<br>' +
                                    '<a href="/syain/delete?id=' + values[0] + '">削除</a>' +
                                    '</td>' +
                                    '</tr>';
                                $('#syainTable tbody').append(row);
                            });
                        }
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log('Error: ' + textStatus + ' ' + errorThrown);
                }
            });
        });
    </script>
    <style>
        .page-header {
            background-color: #eee;
            width: 100%;
            display: flex;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .page-header h1 {
            margin: 0;
            padding: 10px;
            font-size: 20px;
        }
        .right-text {
            text-align: right;
        }

    </style>

</head>
<body>
<form id="syainsearch" th:action="@{/syain/search}" th:object="${searchSyainDTO}" method="post">
    <div class="container">
        <div class="row page-header">
            <h1>社員管理</h1>
        </div>
        <div class="row">
            ■検索条件
        </div>
        <div class="row form-group">
            <div class="col-md-6 col-sm-12 col-xs-12 form-inline">
                <label for="kaisya" class="col-md-3 col-sm-6 col-xs-12 form-label">所属会社</label>
                <select id="kaisya" th:field="*{syozoku_kaisya}" class="col-md-5 col-sm-10 col-xs-12 form-select"></select>
            </div>
            <div class="col-md-6 col-sm-12 col-xs-12 form-inline">
                <label for="kanjiname" class="col-md-3 col-sm-6 col-xs-12 form-label">社員名</label>
                <input id="kanjiname" type="text" th:field="*{nameKanji}" class="col-md-6 col-sm-10 col-xs-12 form-control">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-md-6 col-sm-12 col-xs-12 form-inline">
                <label for="syokugyo" class="col-md-3 col-sm-6 col-xs-12 form-label">職業種類</label>
                <select id="syokugyo" th:field="*{syokugyo_kind}" class="col-md-5 col-sm-10 col-xs-12 form-select"></select>
            </div>

            <div class="col-md-6 col-sm-12 col-xs-12 form-inline">
                <div class="form-check form-check-inline col-md-3 col-sm-6 col-xs-12">
                    <input class="form-check-input" th:field="*{ZAISYA}" type="checkbox" id="zaisya" value="1">
                    <label class="form-check-label" for="zaisya">在職</label>
                </div>
                <div class="form-check form-check-inline col-md-3 col-sm-6 col-xs-12">
                    <input class="form-check-input" th:field="*{TAISYA}" type="checkbox" id="taisya" value="0">
                    <label class="form-check-label" for="taisya">非在職</label>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center">
            <button id="search" type="submit" class="btn btn-secondary btn-sm">検　索</button>
        </div>
    </div>
</form>
<div class="container">
    <div class="row">
        ■社員一覧
    </div>
    <div id="countandnewsyain" class="right-text">
        件数：<span id="cnt"></span> <a href="/syain/upload/syain">新規登録</a>
    </div>
    <table id="syainTable" class="table">
        <thead>
        <tr class="table-primary">
            <th scope="col">所属会社</th>
            <th scope="col">社員名</th>
            <th scope="col">性別</th>
            <th scope="col">職業種類</th>
            <th scope="col">入社日</th>
            <th scope="col">退社日</th>
            <th scope="col">職務経歴書</th>
            <th scope="col">編集</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

</body>


</html>